<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>支出を追加</title>
    </head>
    <body>
        <h1>支出を追加</h1>
        <form id="expenseForm">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="button" onclick="submitForm()">送信</button>
            <a href="{% url 'expense_list' %}">
                <button type="button">閉じる</button>
            </a>
        </form>

        <script>
            function submitForm() {
                const form = document.getElementById('expenseForm');
                const formData = new FormData(form);
        
                fetch('{% url "add_expense" %}', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        window.opener.location.reload();
                        window.close();
                    } else {
                        alert('データの送信に失敗しました: ' + JSON.stringify(data.errors));
                    }
                });
            }
        </script>
    </body>
</html>